name: release

on:
  push:
    branches:
      - main
    # Sequence of patterns matched against refs/tags
    tags:
      - 0.*

jobs:
  if_release:
    if: |
        true
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install uv
        uses: astral-sh/setup-uv@v1
        with:
          python-version: "3.10"
      - name: Build project for distribution
        run: uv build
      - name: Check Version
        id: check-version
        run: |
          VERSION=$(python - <<'PY'
import re
from pathlib import Path

content = Path("pyproject.toml").read_text()
match = re.search(r'^version\s*=\s*"([^"]+)"', content, re.MULTILINE)
if not match:
    raise SystemExit("version not found")

print(match.group(1))
PY
)
          echo "version=$VERSION" >> "$GITHUB_OUTPUT"
      - name: Publish to PyPI
        env:
          PYPI_API_TOKEN: ${{ secrets.PYPI_API_TOKEN }}
        run: uv publish --token "$PYPI_API_TOKEN"
